"use strict";
// Copyright IBM Corp. 2020. All Rights Reserved.
// Node module: @loopback/apiconnect
// This file is licensed under the MIT License.
// License text available at https://opensource.org/licenses/MIT
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApiConnectSpecEnhancer = void 0;
const tslib_1 = require("tslib");
const core_1 = require("@loopback/core");
const rest_1 = require("@loopback/rest");
/**
 * An OpenAPI spec enhancer to add `x-ibm-configuration` extension required
 * by API Connect
 */
let ApiConnectSpecEnhancer = class ApiConnectSpecEnhancer {
    constructor(options, appMetadata = {
        name: 'LoopBack Application',
        version: '1.0.0',
        description: 'LoopBack 4 Application',
    }) {
        this.options = options;
        this.appMetadata = appMetadata;
        this.name = 'IBM API Connect';
    }
    modifySpec(spec) {
        // Add `x-ibm-name`
        spec.info = { 'x-ibm-name': this.appMetadata.name, ...spec.info };
        // Add `x-ibm-configuration`
        spec['x-ibm-configuration'] = {
            assembly: {
                execute: [
                    {
                        invoke: {
                            title: 'invoke',
                            version: '2.0.0',
                            'target-url': this.options.targetUrl,
                        },
                    },
                ],
            },
            cors: {
                enabled: true,
            },
            enforced: true,
            phase: 'realized',
            testable: true,
            gateway: 'datapower-api-gateway',
        };
        return spec;
    }
};
ApiConnectSpecEnhancer = (0, tslib_1.__decorate)([
    (0, core_1.injectable)(rest_1.asSpecEnhancer),
    (0, tslib_1.__param)(0, (0, core_1.config)({ optional: false })),
    (0, tslib_1.__param)(1, (0, core_1.inject)(core_1.CoreBindings.APPLICATION_METADATA, { optional: true })),
    (0, tslib_1.__metadata)("design:paramtypes", [Object, Object])
], ApiConnectSpecEnhancer);
exports.ApiConnectSpecEnhancer = ApiConnectSpecEnhancer;
//# sourceMappingURL=apiconnect.spec-enhancer.js.map